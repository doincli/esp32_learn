# 配网过程

```log

I (1149) EXAMPLE: ESP_BLE_MESH_PROVISIONER_SET_DEV_UUID_MATCH_COMP_EVT, err_code 0
I (1149) EXAMPLE: ESP_BLE_MESH_PROVISIONER_SET_DEV_UUID_MATCH_COMP_EVT, finish 

I (1159) EXAMPLE: BLE Mesh Provisioner initialized

I (1169) EXAMPLE: ESP_BLE_MESH_PROVISIONER_PROV_ENABLE_COMP_EVT, err_code 0
I (1169) EXAMPLE: ESP_BLE_MESH_PROVISIONER_PROV_ENABLE_COMP_EVT, finish 

I (1179) EXAMPLE: ESP_BLE_MESH_PROVISIONER_ADD_LOCAL_APP_KEY_COMP_EVT, err_code 0
prov_key refresh  app_idx : 0
I (1189) EXAMPLE: ESP_BLE_MESH_PROVISIONER_BIND_APP_KEY_TO_MODEL_COMP_EVT, err_code 0
node_0  unicast :  0,elements: 0
```

配网过程：

基础准备工作

1. esp_ble_mesh_init   初始化 BLE Mesh 模块。该API初始化供应能力和组成数据信息。
2. esp_ble_mesh_provisioner_set_dev_uuid_match ------Provisioner 调用此函数来设置在开始配置之前要比较的设备 UUID 部分。
3. esp_ble_mesh_provisioner_prov_enable            启用一个或多个配置承载
4. esp_ble_mesh_provisioner_add_local_app_key          调用该函数为Provisioner添加本地AppKey。



回调函数出现的事件顺序

1. ESP_BLE_MESH_PROVISIONER_SET_DEV_UUID_MATCH_COMP_EVT
   Provisioner 设置要与部分未配置设备 UUID 完成事件进行比较的值

2. ESP_BLE_MESH_PROVISIONER_PROV_ENABLE_COMP_EVT
   Provisioner 启用供应功能完成事件

3. ESP_BLE_MESH_PROVISIONER_ADD_LOCAL_APP_KEY_COMP_EVT
   Provisioner 添加本地应用程序密钥完成事件
   **在这个事件中调用esp_ble_mesh_provisioner_bind_app_key_to_local_model 将自己的模型与正确的应用程序密钥绑定**

4. ESP_BLE_MESH_PROVISIONER_BIND_APP_KEY_TO_MODEL_COMP_EVT

   Provisioner 将本地模型与本地应用程序密钥完成事件绑定
   到这里如果没有新的节点加入，程序进入阻塞状态

5. ESP_BLE_MESH_PROVISIONER_RECV_UNPROV_ADV_PKT_EVT
   Provisioner 收到未配置的设备信标事件    调用recv_unprov_adv_pkt
   **在这个事件中调用esp_ble_mesh_provisioner_add_unprov_dev 将未配置的设备信息添加到 unprov_dev 队列**

6. ESP_BLE_MESH_PROVISIONER_PROV_LINK_OPEN_EVT
   Provisioner 建立 BLE Mesh 链接事件

7. ESP_BLE_MESH_PROVISIONER_ADD_UNPROV_DEV_COMP_EVT
   Provisioner 将设备添加到列表中，其中包含正在等待/将要配置完成事件的设备

8. ESP_BLE_MESH_PROVISIONER_PROV_COMPLETE_EVT
   Provisioner 配置完成事件  调用prov_complete
   **在这个事件中调用esp_ble_mesh_provisioner_set_node_name来设置节点（配置的设备）名称**
   调用example_ble_mesh_set_msg_common收集common模型命令

9. ESP_BLE_MESH_PROVISIONER_SET_NODE_NAME_COMP_EVT
   Provisioner 设置节点名称完成事件

10. ESP_BLE_MESH_PROVISIONER_PROV_LINK_CLOSE_EVT
    Provisioner 关闭 BLE Mesh 链接事件